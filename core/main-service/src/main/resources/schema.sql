CREATE TABLE IF NOT EXISTS users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name VARCHAR (255) NOT NULL,
    email VARCHAR (255) NOT NULL,
    CONSTRAINT pk_users PRIMARY KEY (id),
    CONSTRAINT uq_user_email UNIQUE (email)
);


CREATE TABLE IF NOT EXISTS categories (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    CONSTRAINT uq_category_name UNIQUE (name)
);

CREATE TABLE IF NOT EXISTS events (
 id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
 annotation VARCHAR(5000) NOT NULL,
 category BIGINT NOT NULL,
 confirmed_requests INTEGER NOT NULL,
 created_on TIMESTAMP WITHOUT TIME ZONE NOT NULL,
 description VARCHAR (10000) NOT NULL,
 event_date TIMESTAMP WITHOUT TIME ZONE NOT NULL,
 initiator BIGINT NOT NULL,
 location_lat FLOAT NOT NULL,
 location_lon FLOAT NOT NULL,
 paid BOOLEAN NOT NULL,
 participant_limit INT NOT NULL,
 published_on TIMESTAMP WITHOUT TIME ZONE NOT NULL,
 request_moderation BOOLEAN NOT NULL,
 state VARCHAR(20) NOT NULL,
 title VARCHAR (300) NOT NULL,
 CONSTRAINT pk_events PRIMARY KEY (id),
 CONSTRAINT fk_event_user FOREIGN KEY (initiator) REFERENCES users (id),
 CONSTRAINT fk_event_category FOREIGN KEY (category) REFERENCES categories (id) ON DELETE RESTRICT
);


CREATE TABLE IF NOT EXISTS requests (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    event BIGINT REFERENCES events (id) NOT NULL,
    requester BIGINT REFERENCES users (id) NOT NULL,
    status varchar NOT NULL
);

CREATE TABLE IF NOT EXISTS compilations (
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
pinned BOOLEAN NOT NULL,
title VARCHAR (255) NOT NULL,
CONSTRAINT pk_compilations PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS event_compilation (
event_id BIGINT REFERENCES events (id) ON DELETE CASCADE,
compilation_id BIGINT REFERENCES compilations (id) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS comments (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    text VARCHAR NOT NULL,
    created TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    author BIGINT REFERENCES users (id) ON DELETE CASCADE,
    event BIGINT REFERENCES events (id) ON DELETE CASCADE
);
